# cozy-docker

Simple Cozy docker image provided without CouchDB nor reverse proxy.

## What is cozy ?

> Store, sync, and share your data just the way you want it.

More informations on [Cozy website](https://cozy.io).

## Installation

* Install Docker
* Fetch cozy-docker image:
```bash
sudo docker pull waidd/cozy-docker
```
* Or build it manually by running:
```bash
sudo docker build -t waidd/cozy github.com/waidd/cozy-docker
```

## Usage
### CouchDB

Cozy need a CouchDB database. You can get it this way :

* Fetch CouchDB image:
```bash
sudo docker pull couchdb
```
* Start CouchDB container:
```bash
sudo docker run
  --detach \
  --restart=always \
  --name cozy-couchdb \
  couchdb
```

### Cozy

Start Cozy container:
```bash
sudo docker run \
  --detach \
  --restart=always \
  --publish 9104:9104 \
  --link cozy-couchdb:couchdb \
  --name cozy \
  waidd/cozy-docker
```

Initialization will take some time.

### Reverse Proxy

Use a reserve proxy to serve cozy application.

Sample nginx vhost :
```
server {
  listen 80;
  listen [::]:80;
  server_name my-cozy-url.com;
  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl;
  listen [::]:443 ssl;

  # Self signed certs generated by the ssl-cert package
  # Don't use them in a production server!
  # You should provide your own certificates.
  include snippets/snakeoil.conf;

  server_name my-website.com;

  location / {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_pass http://127.0.0.1:9104;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
  }
}
```

## TODO List

- [ ] Describe how to save data.
- [ ] Don't expose port ?
- [ ] Expose API port ?
